<!DOCTYPE html>
<html>
<head>
    <title>Carla Maths App - 1¬∫ ESO</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
            color: #333;
            text-align: center;
            touch-action: pan-y;
        }
        .screen {
            display: none;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .screen.active {
            display: block;
        }
        /* Estilos de la pantalla de Ejercicios */
        #exerciseScreen { background-color: #e6ffe6; } /* Verde claro */
        .question-box {
            background-color: #fff;
            border: 2px solid #5cb85c;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        /* COLORES DE BOTONES PARA MEJOR CONTRASTE */
        .options button {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
            /* Tono verde claro pastel para botones normales */
            background-color: #a4e4a4; /* Verde muy claro para el bot√≥n inactivo */
            color: #333; /* Texto oscuro para contraste */
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .options button:hover:not(:disabled) {
            background-color: #79d279; /* Un poco m√°s oscuro al pasar el rat√≥n */
        }
        .options button.correct {
            /* Verde fuerte para la respuesta correcta */
            background-color: #28a745; 
            color: white; /* Texto blanco en verde oscuro */
            font-weight: bold;
        }
        .options button.wrong {
            /* ROJO CLARO para la respuesta incorrecta seleccionada */
            background-color: #f17b7b; 
            color: #333; /* Texto oscuro en el bot√≥n que fall√≥ */
        }
        /* Aseguramos que los botones deshabilitados sean muy claros */
        .options button:disabled {
            opacity: 0.8;
            cursor: default;
        }
        
        .gamification {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            border-bottom: 2px solid #ccc;
        }
        .progress-bar-container {
            width: 50%;
            background-color: #eee;
            border-radius: 5px;
            overflow: hidden;
            margin: 0 10px;
            height: 20px;
        }
        #progress {
            height: 100%;
            width: 0%;
            background-color: #ffc107; /* Amarillo para progreso */
            transition: width 0.5s;
        }
        .medal {
            font-size: 1.5em;
            opacity: 0.3;
        }
        .medal.active {
            opacity: 1;
        }

        /* =================================================================== */
        /* Estilos de la pantalla de Juego (Arcanoid) */
        /* =================================================================== */
        #gameScreen {
            background-color: #202020;
            min-height: auto;
            /* Flexbox para centrar el canvas y el juego de memoria */
            display: none; 
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }
        #gameScreen.active {
            display: flex; 
        }

        /* Estilos ARCANOID */
        #juegoCanvas {
            border: 4px solid #fff;
            background: #000;
            display: block;
            margin: 20px auto;
            touch-action: none; 
        }
        #gameControls {
            margin-top: 15px;
        }

        /* =================================================================== */
        /* Estilos JUEGO DE PARES (Memory) */
        /* =================================================================== */
        #memoryGameContainer {
            width: 100%; /* Ocupa el ancho de la pantalla */
            max-width: 320px;
            display: none; /* Oculto por defecto */
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #fce4ec; /* Fondo rosa claro */
            border-radius: 10px;
        }

        #memoryGameContainer.active {
            display: flex;
        }

        #memoryGameContainer header h1 {
            color: #d81b60; /* Rosa fuerte */
            font-size: 1.8em;
            text-align: center;
        }

        #memoryGameContainer p {
            color: #4a148c;
            font-weight: 600;
        }

        .game-container-memory {
            width: 300px; /* Tama√±o adaptado para m√≥vil/tablet */
            height: 350px; 
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 columnas */
            grid-gap: 8px;
            perspective: 1000px;
            margin-top: 15px;
        }

        .memory-card {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform .5s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
            cursor: pointer;
        }

        /* Clase para cuando la carta est√° volteada o emparejada */
        .memory-card.flip, .memory-card.match {
            transform: rotateY(180deg);
        }

        .front-face, .back-face {
            width: 100%;
            height: 100%;
            position: absolute;
            backface-visibility: hidden;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 35px;
        }

        .front-face {
            transform: rotateY(180deg);
            background-color: #ffffff;
        }

        .back-face {
            background-color: #4db6ac; /* Verde azulado para el reverso */
            color: white;
            font-weight: bold;
            font-size: 24px;
            border: 3px solid #00897b;
        }

        #mensaje-victoria-memory {
            margin-top: 30px;
            padding: 20px;
            background-color: #a5d6a7; /* Verde suave */
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 0 15px rgba(0, 150, 0, 0.5);
            width: 80%;
        }
        
        #mensaje-victoria-memory h2 {
            color: #388e3c;
        }

    </style>
</head>
<body>

    <div id="loginScreen" class="screen active">
        <h2>Bienvenida, Carla üëã</h2>
        <p>¬°Vamos a repasar matem√°ticas de 1¬∫ ESO jugando!</p>
        <input type="text" id="studentNameLogin" placeholder="Tu Nombre (Carla)" value="Carla" style="padding: 10px; margin: 10px; width: 80%;">
        <input type="number" id="studentAgeLogin" placeholder="Tu Edad" value="12" style="padding: 10px; margin: 10px; width: 80%;">
        <button onclick="goToSubjectFromLogin()" style="padding: 15px; background-color: #007bff; color: white; border: none; border-radius: 5px; width: 80%; cursor: pointer;">Entrar</button>
    </div>

    <div id="subjectScreen" class="screen">
        <h2>Selecciona tu Tema de Estudio</h2>
        <select id="subjectChoose" disabled style="padding: 10px; margin: 10px; width: 80%;">
            <option value="Matem√°ticas">Matem√°ticas</option>
        </select>
        <select id="evaluationChoose" style="padding: 10px; margin: 10px; width: 80%;">
            <option value="">--Selecciona Evaluaci√≥n--</option>
        </select>
        <select id="topicChoose" style="padding: 10px; margin: 10px; width: 80%;">
            <option value="">--Selecciona Tema--</option>
        </select>
        <button onclick="startExercises()" style="padding: 15px; background-color: #28a745; color: white; border: none; border-radius: 5px; width: 80%; cursor: pointer;">¬°Empezar a Estudiar!</button>
    </div>

    <div id="exerciseScreen" class="screen">
        <div class="gamification">
            <span id="levelDisplay">Nivel: 1</span>
            <div class="progress-bar-container"><div id="progress"></div></div>
            <span id="pointsDisplay">Puntos: 0</span>
            <div id="medals"></div>
        </div>
        
        <p>Est√°s estudiando: <strong id="subjectTopic"></strong></p>
        <p>Pregunta <span id="questionNumber">1</span> de <span id="totalQuestions">20</span></p>

        <div class="question-box">
            <p id="questionText">Cargando pregunta...</p>
        </div>
        
        <div class="options" onclick="handleOptionClick(event)">
            <button data-option-index="0"></button>
            <button data-option-index="1"></button>
            <button data-option-index="2"></button>
            <button data-option-index="3"></button>
        </div>

        <button onclick="nextQuestion()" style="padding: 15px; margin-top: 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; width: 80%; cursor: pointer;">Siguiente Pregunta</button>
        <button onclick="goToReview()" style="padding: 10px; margin-top: 10px; background-color: #6c757d; color: white; border: none; border-radius: 5px; width: 80%; cursor: pointer;">Terminar Sesi√≥n (Revisar)</button>
    </div>

    <div id="gameScreen" class="screen">
        <h2>¬°FELICIDADES, Carla! ¬°PREMIO! üéâ</h2>
        <p>Has subido al Nivel <span id="rewardLevel"></span>. T√≥mate un descanso y ¬°a jugar!</p>
        
        <div id="arcanoidGameContainer">
            <canvas id="juegoCanvas" width="320" height="480"></canvas>
        </div>

        <div id="memoryGameContainer" style="font-family: 'Comic Sans MS', cursive, sans-serif;">
            <header>
                <h1>Juego de Pares de Emojis</h1>
                <p>Toca dos cartas para encontrar las parejas. ¬°Hay 5 pares!</p>
            </header>
            <main class="game-container-memory">
            </main>
            <div id="mensaje-victoria-memory" style="display: none;">
                <h2>¬°GANASTE! üèÜ Eres incre√≠blemente inteligente.</h2>
                <button id="restartMemory" style="padding: 10px 20px; font-size: 1.2em; cursor: pointer; margin-top: 10px; background-color: #e91e63; color: white; border: none; border-radius: 5px;">Jugar de nuevo</button>
            </div>
        </div>
        
        <div id="gameControls">
            <button id="endGameButton" onclick="endGame()" style="padding: 10px; background-color: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer;">Volver a los Ejercicios</button>
        </div>
        
    </div>

    <div id="reviewScreen" class="screen">
        <h2>Revisi√≥n de la Sesi√≥n</h2>
        <p>Puntuaci√≥n Final: <strong id="finalPoints">0</strong> puntos.</p>
        <p>Nivel Alcanzado: <strong id="finalLevel">1</strong></p>
        <h3>Preguntas Acertadas:</h3>
        <div id="reviewQuestions" style="text-align: left; padding: 0 20px;">
            </div>
        <button onclick="goToSubjectFromExercise()" style="padding: 15px; margin-top: 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; width: 80%; cursor: pointer;">Elegir Otro Tema</button>
    </div>

    <script>
        // ===================================================================
        // 1. ESTRUCTURA CURRICULAR (TU C√ìDIGO)
        // ===================================================================
        const curriculum = {
            "Matem√°ticas": {
                "1¬∫ESO": {
                    "1¬™ evaluaci√≥n": {
                        "N√∫meros y Operaciones": [
                            { q: "¬øC√≥mo se lee 1.345.000?", options: ["Un mill√≥n trescientos cuarenta y cinco mil", "Trece millones", "Ciento treinta y cuatro mil", "Un bill√≥n"], correct: 0 },
                            { q: "Valor posicional del 7 en 1.705:", options: ["Unidades", "Decenas", "Centenas", "Unidades de Millar"], correct: 2 },
                            { q: "¬øCu√°l es el resultado de 100 - 45?", options: ["65", "55", "45", "145"], correct: 1 },
                            { q: "¬øCu√°l es el resultado de 12 √ó 5?", options: ["60", "50", "17", "70"], correct: 0 },
                            { q: "¬øCu√°l es el resultado de 81 / 9?", options: ["7", "8", "9", "10"], correct: 2 },
                            { q: "El valor posicional del 2 en 2.050.000 es...", options: ["Unidad de Millar", "Centena de Millar", "Unidad de mill√≥n", "Decena de Millar"], correct: 2 },
                            { q: "¬øCu√°nto es 35 + 15 + 10?", options: ["50", "60", "70", "40"], correct: 1 },
                            { q: "¬øCu√°nto es 10 √ó 10 √ó 10?", options: ["100", "30", "1.000", "100.000"], correct: 2 },
                            { q: "¬øCu√°nto es 48 / 6?", options: ["7", "8", "6", "9"], correct: 1 },
                            { q: "El n√∫mero 9 es divisible por...", options: ["2", "4", "3", "5"], correct: 2 },
                            { q: "El n√∫mero 12 es m√∫ltiplo de...", options: ["5", "7", "4", "9"], correct: 2 },
                            { q: "Un n√∫mero primo es aquel que tiene solo dos divisores:", options: ["√âl mismo y el 1", "El 2 y el 3", "Cualquier par de n√∫meros", "N√∫meros impares"], correct: 0 },
                            { q: "¬øCu√°l de estos es un n√∫mero primo?", options: ["4", "9", "10", "7"], correct: 3 },
                            { q: "¬øCu√°l de estos es un n√∫mero compuesto?", options: ["3", "5", "8", "11"], correct: 2 },
                            { q: "M√∫ltiplos de 5, el siguiente a 20 es:", options: ["21", "25", "30", "15"], correct: 1 },
                            { q: "Divisores de 10:", options: ["1, 2, 5, 10", "1, 5, 10", "1, 2, 4, 5", "5, 10"], correct: 0 },
                            { q: "M.C.D de 4 y 6:", options: ["24", "12", "2", "4"], correct: 2 },
                            { q: "m.c.m de 2 y 3:", options: ["1", "6", "3", "2"], correct: 1 },
                            { q: "¬øCu√°nto es 5¬≤?", options: ["10", "7", "25", "52"], correct: 2 },
                            { q: "Ra√≠z cuadrada de 9:", options: ["2", "3", "4", "81"], correct: 1 },
                            { q: "La suma de los n√∫meros 125 y 75 es:", options: ["100", "200", "50", "25"], correct: 1 },
                            { q: "La diferencia entre 50 y 15 es:", options: ["65", "45", "35", "50"], correct: 2 },
                            { q: "El producto de 9 y 8 es:", options: ["17", "72", "64", "81"], correct: 1 },
                            { q: "El cociente de 40 entre 5 es:", options: ["6", "7", "8", "9"], correct: 2 },
                            { q: "¬øCu√°l es el valor posicional de la primera cifra de la izquierda en 5.678?", options: ["Centenas", "Decenas de Millar", "Unidades de Millar", "Decenas"], correct: 2 },
                            { q: "Para que un n√∫mero sea divisible por 10 debe terminar en:", options: ["5", "N√∫mero par", "0", "Cualquier n√∫mero"], correct: 2 },
                            { q: "Un n√∫mero es m√∫ltiplo de 2 si es:", options: ["Impar", "Par", "Termina en 5", "Primo"], correct: 1 },
                            { q: "El n√∫mero 15 es divisible por:", options: ["2", "4", "5", "6"], correct: 2 },
                            { q: "Ra√≠z cuadrada de 49:", options: ["6", "7", "8", "9"], correct: 1 },
                            { q: "¬øCu√°nto es 3¬≥?", options: ["9", "27", "6", "81"], correct: 1 },
                            { q: "m.c.m de 4 y 5:", options: ["9", "10", "20", "40"], correct: 2 },
                            { q: "M.C.D de 10 y 15:", options: ["5", "15", "10", "30"], correct: 0 },
                            { q: "El n√∫mero 2 es:", options: ["Compuesto", "Impar", "El √∫nico primo par", "M√∫ltiplo de 4"], correct: 2 },
                            { q: "El n√∫mero 1 es:", options: ["Primo", "Compuesto", "Neutro", "Un divisor universal"], correct: 3 },
                            { q: "Divisores de 7:", options: ["1, 7", "1, 2, 7", "7, 14", "1, 3, 7"], correct: 0 },
                            { q: "¬øCu√°nto es 20 + 5 √ó 2 (Operaciones combinadas)?", options: ["50", "22", "30", "25"], correct: 2 },
                            { q: "¬øCu√°nto es (10 - 2) √ó 3?", options: ["8", "24", "16", "26"], correct: 1 },
                            { q: "Ra√≠z cuadrada de 100:", options: ["100", "50", "10", "25"], correct: 2 },
                            { q: "El resultado de 15 / 3 + 4 es:", options: ["7", "9", "5", "8"], correct: 3 },
                            { q: "¬øCu√°l es el valor de 10‚Å¥?", options: ["100", "10.000", "1.000", "40"], correct: 1 },
                        ]
                    },
                    "2¬™ evaluaci√≥n": {
                        "Fracciones": [
                            // Bloque 1: Lectura, Representaci√≥n y Comparaci√≥n
                            { q: "¬øC√≥mo se lee 3/5?", options: ["Tres quinto", "Tres quintos", "Tres partido cinco", "Cinco tercios"], correct: 1 },
                            { q: "¬øC√≥mo se lee 1/2?", options: ["Un dos", "Un medio", "La mitad", "Dos uno"], correct: 1 },
                            { q: "¬øCu√°l es el numerador en 4/7?", options: ["7", "4", "11", "3"], correct: 1 },
                            { q: "¬øCu√°l es el denominador en 5/8?", options: ["5", "8", "13", "3"], correct: 1 },
                            { q: "¬øCu√°l es mayor: 3/4 o 1/4?", options: ["1/4", "3/4", "Son iguales", "Falta dato"], correct: 1 },
                            { q: "¬øCu√°l es menor: 2/5 o 4/5?", options: ["4/5", "2/5", "Son iguales", "Falta dato"], correct: 1 },
                            { q: "¬øC√≥mo se lee 7/10?", options: ["Siete d√©cimo", "Siete d√©cimos", "Diez s√©ptimos", "Siete diez"], correct: 1 },
                            { q: "¬øCu√°l es la fracci√≥n para un cuarto?", options: ["4/1", "1/4", "1/2", "2/4"], correct: 1 },
                            { q: "¬øQu√© fracci√≥n es 0.5?", options: ["1/4", "1/3", "1/2", "1/5"], correct: 2 },
                            { q: "¬øCu√°l es mayor: 1/2 o 1/3?", options: ["1/3", "1/2", "Son iguales", "Falta dato"], correct: 1 },
                            { q: "¬øCu√°l es menor: 2/7 o 2/3?", options: ["2/3", "2/7", "Son iguales", "Falta dato"], correct: 1 },
                            { q: "Fracci√≥n Propia (Num < Den):", options: ["5/3", "3/5", "5/5", "6/2"], correct: 1 },
                            { q: "Fracci√≥n Impropia (Num > Den):", options: ["1/2", "3/4", "4/3", "2/5"], correct: 2 },
                            { q: "¬øC√≥mo se lee 2/3?", options: ["Dos tercios", "Tres medios", "Dos tres", "Dos terzos"], correct: 0 },
                            { q: "¬øCu√°l es el numerador en 8/9?", options: ["9", "8", "17", "1"], correct: 1 },
                            { q: "¬øCu√°l es mayor: 5/6 o 4/6?", options: ["4/6", "5/6", "Son iguales", "Falta dato"], correct: 1 },
                            { q: "¬øCu√°l es menor: 3/10 o 7/10?", options: ["7/10", "3/10", "Son iguales", "Falta dato"], correct: 1 },
                            { q: "El n√∫mero 1 se representa como:", options: ["1/2", "3/4", "5/5", "2/1"], correct: 2 },
                            { q: "Fracci√≥n con Denominador 6:", options: ["6/1", "1/6", "6", "1/2"], correct: 1 },
                            { q: "¬øCu√°l es mayor: 5/7 o 3/7?", options: ["3/7", "5/7", "Son iguales", "Falta dato"], correct: 1 },
                            { q: "¬øCu√°l es menor: 1/5 o 1/8?", options: ["1/5", "1/8", "Son iguales", "Falta dato"], correct: 1 },
                            { q: "¬øC√≥mo se lee 9/4?", options: ["Nueve cuartos", "Cuatro novenos", "Nueve cuatro", "Cuatro cuartos"], correct: 0 },
                            { q: "¬øCu√°l es el denominador en 1/9?", options: ["1", "9", "0", "10"], correct: 1 },
                            { q: "Fracci√≥n equivalente a 1/1 (un entero):", options: ["1/2", "2/3", "4/4", "3/1"], correct: 2 },
                            { q: "¬øCu√°l es mayor: 5/12 o 7/12?", options: ["5/12", "7/12", "Son iguales", "Falta dato"], correct: 1 },
                            { q: "¬øCu√°l es menor: 2/9 o 2/5?", options: ["2/5", "2/9", "Son iguales", "Falta dato"], correct: 1 },

                            // Bloque 2: Fracciones Equivalentes y Simplificaci√≥n
                            { q: "Fracci√≥n equivalente a 1/2:", options: ["3/4", "2/4", "1/3", "4/6"], correct: 1 },
                            { q: "Fracci√≥n equivalente a 1/3:", options: ["2/6", "1/6", "2/5", "3/4"], correct: 0 },
                            { q: "Simplifica 5/10 (dividir por 5):", options: ["5/2", "1/5", "1/2", "1/1"], correct: 2 },
                            { q: "Simplifica 6/9 (dividir por 3):", options: ["3/6", "2/3", "6/3", "1/9"], correct: 1 },
                            { q: "Fracci√≥n equivalente a 3/3:", options: ["1/3", "3/1", "4/4", "6/9"], correct: 2 },
                            { q: "Fracci√≥n equivalente a 2/5:", options: ["4/5", "4/10", "2/10", "5/2"], correct: 1 },
                            { q: "Simplifica 8/12 (dividir por 4):", options: ["2/3", "4/6", "1/2", "8/4"], correct: 0 },
                            { q: "Fracci√≥n equivalente a 1/4:", options: ["2/8", "1/8", "2/4", "4/16"], correct: 0 },
                            { q: "Simplifica 4/6 (dividir por 2):", options: ["2/3", "1/3", "4/2", "3/2"], correct: 0 },
                            { q: "Fracci√≥n equivalente a 3/1:", options: ["3/3", "1/3", "6/2", "3/6"], correct: 2 },
                            { q: "Fracci√≥n equivalente a 4/8:", options: ["1/4", "1/2", "2/8", "3/4"], correct: 1 },
                            { q: "Simplifica 10/10 (dividir por 10):", options: ["1/5", "1/1", "2/1", "10/1"], correct: 1 },
                            { q: "Fracci√≥n equivalente a 2/2:", options: ["2/4", "1/1", "3/2", "2/1"], correct: 1 },
                            { q: "Fracci√≥n equivalente a 5/6:", options: ["10/12", "5/12", "6/5", "10/6"], correct: 0 },
                            { q: "Simplifica 12/15 (dividir por 3):", options: ["4/5", "3/5", "12/5", "5/4"], correct: 0 },
                            { q: "Fracci√≥n equivalente a 7/7:", options: ["14/14", "7/1", "1/7", "7/14"], correct: 0 },
                            { q: "Fracci√≥n equivalente a 1/5:", options: ["2/10", "1/10", "2/5", "5/10"], correct: 0 },
                            { q: "Simplifica 20/30 (dividir por 10):", options: ["1/3", "2/3", "3/2", "1/2"], correct: 1 },
                            { q: "Fracci√≥n equivalente a 3/2:", options: ["6/4", "3/4", "2/3", "4/6"], correct: 0 },
                            { q: "Simplifica 14/21 (dividir por 7):", options: ["2/3", "3/4", "1/2", "7/3"], correct: 0 },
                            { q: "Fracci√≥n equivalente a 1/6:", options: ["2/12", "1/12", "6/1", "2/6"], correct: 0 },
                            { q: "Simplifica 9/12 (dividir por 3):", options: ["1/4", "3/4", "9/3", "4/3"], correct: 1 },
                            { q: "Fracci√≥n equivalente a 4/5:", options: ["8/10", "4/10", "5/4", "10/8"], correct: 0 },
                            { q: "Simplifica 15/20 (dividir por 5):", options: ["3/4", "4/3", "5/4", "15/5"], correct: 0 },
                            { q: "Fracci√≥n equivalente a 1/10:", options: ["2/20", "1/20", "10/1", "2/10"], correct: 0 },
                            { q: "Simplifica 2/8 (dividir por 2):", options: ["1/4", "1/2", "2/4", "2/1"], correct: 0 },

                            // Bloque 3: Operaciones con Fracciones (Mismo denominador y multiplicaci√≥n simple)
                            { q: "¬øCu√°nto es 1/5 + 2/5?", options: ["3/10", "3/5", "1/5", "2/10"], correct: 1 },
                            { q: "¬øCu√°nto es 4/7 - 1/7?", options: ["3/7", "5/7", "3/0", "4/1"], correct: 0 },
                            { q: "¬øCu√°nto es 1/4 √ó 2?", options: ["2/8", "2/4", "1/8", "3/4"], correct: 1 },
                            { q: "¬øCu√°nto es 2/3 + 1/3?", options: ["3/6", "3/3", "1/3", "2/3"], correct: 1 },
                            { q: "¬øCu√°nto es 5/6 - 2/6?", options: ["3/0", "3/6", "7/6", "5/2"], correct: 1 },
                            { q: "¬øCu√°nto es 3/5 √ó 2?", options: ["6/10", "6/5", "3/10", "5/6"], correct: 1 },
                            { q: "¬øCu√°nto es 3/8 + 4/8?", options: ["7/16", "7/8", "1/8", "7/0"], correct: 1 },
                            { q: "¬øCu√°nto es 9/10 - 4/10?", options: ["5/10", "13/10", "5/0", "9/4"], correct: 0 },
                            { q: "¬øCu√°nto es 1/10 √ó 3?", options: ["3/30", "3/10", "1/30", "4/10"], correct: 1 },
                            { q: "¬øCu√°nto es 1/6 + 2/6?", options: ["3/12", "3/6", "1/6", "2/6"], correct: 1 },
                            { q: "¬øCu√°nto es 7/9 - 5/9?", options: ["2/0", "12/9", "2/9", "7/5"], correct: 2 },
                            { q: "¬øCu√°nto es 2/7 √ó 2?", options: ["4/14", "4/7", "2/14", "7/4"], correct: 1 },
                            { q: "¬øCu√°nto es 5/11 + 3/11?", options: ["8/22", "8/11", "2/11", "5/3"], correct: 1 },
                            { q: "¬øCu√°nto es 6/8 - 1/8?", options: ["5/0", "5/8", "7/8", "6/1"], correct: 1 },
                            { q: "¬øCu√°nto es 4/9 √ó 2?", options: ["8/18", "8/9", "4/18", "9/8"], correct: 1 },
                            { q: "¬øCu√°nto es 1/2 + 1/2?", options: ["2/4", "2/2", "1/2", "0/2"], correct: 1 },
                            { q: "¬øCu√°nto es 10/10 - 3/10?", options: ["7/20", "7/10", "13/10", "7/0"], correct: 1 },
                            { q: "¬øCu√°nto es 5/12 √ó 2?", options: ["10/24", "10/12", "5/24", "12/10"], correct: 1 },
                            { q: "¬øCu√°nto es 1/8 + 1/8?", options: ["2/16", "2/8", "1/8", "0/8"], correct: 1 },
                            { q: "¬øCu√°nto es 4/5 - 1/5?", options: ["3/0", "3/5", "5/5", "4/1"], correct: 1 },
                            { q: "¬øCu√°nto es 1/7 √ó 5?", options: ["5/35", "5/7", "1/35", "7/5"], correct: 1 },
                            { q: "¬øCu√°nto es 2/9 + 4/9?", options: ["6/18", "6/9", "2/9", "4/9"], correct: 1 },
                        ]
                    },
                    "3¬™ evaluaci√≥n": {
                        "Estad√≠stica": [
                            // Bloque 1: Definiciones y Reconocimiento
                            { q: "El promedio de los datos es la...", options: ["Moda", "Mediana", "Media", "Frecuencia"], correct: 2 },
                            { q: "El valor que m√°s se repite es la...", options: ["Media", "Mediana", "Moda", "Promedio"], correct: 2 },
                            { q: "El valor central de los datos es la...", options: ["Media", "Mediana", "Moda", "Frecuencia"], correct: 1 },
                            { q: "¬øQu√© es el promedio?", options: ["El valor central", "La suma de datos/n¬∫ de datos", "El valor repetido", "El valor mayor"], correct: 1 },
                            { q: "Para calcular la Mediana, primero hay que...", options: ["Sumar datos", "Dividir", "Ordenar datos", "Contar datos"], correct: 2 },
                            { q: "La Media es sensible a valores...", options: ["Centrales", "Peque√±os", "Extremos", "Repetidos"], correct: 2 },
                            { q: "El valor 5 aparece 10 veces. Esto es la...", options: ["Media", "Mediana", "Moda", "Frecuencia"], correct: 3 },
                            { q: "¬øQu√© medida se puede usar con datos NO num√©ricos (cualitativos)?", options: ["Media", "Mediana", "Moda", "Rango"], correct: 2 },
                            { q: "En datos ordenados, la Mediana es la posici√≥n...", options: ["Inicial", "Final", "Central", "Mayor"], correct: 2 },
                            { q: "La suma de datos entre el n√∫mero de datos es la f√≥rmula de la...", options: ["Moda", "Mediana", "Media", "Frecuencia"], correct: 2 },
                            { q: "Un dato que aparece muchas veces est√° 'de'...", options: ["Mediana", "Promedio", "Moda", "Media"], correct: 2 },
                            { q: "Si la lista de datos es par, la Mediana es la media de los dos valores...", options: ["Primeros", "√öltimos", "Centrales", "Mayores"], correct: 2 },
                            { q: "La Media representa el valor...", options: ["M√°ximo", "T√≠pico/Promedio", "M√≠nimo", "Repetido"], correct: 1 },
                            { q: "La Mediana divide la muestra en dos partes iguales: un 50% y un...", options: ["25%", "75%", "50%", "100%"], correct: 2 },
                            { q: "N√∫mero de veces que se repite un dato (ni):", options: ["Mediana", "Moda", "Frecuencia absoluta", "Media"], correct: 2 },
                            { q: "¬øQu√© medida representa el centro de gravedad de los datos?", options: ["Moda", "Mediana", "Media", "Rango"], correct: 2 },
                            { q: "El dato con mayor Frecuencia Absoluta es la...", options: ["Media", "Mediana", "Moda", "Rango"], correct: 2 },
                            { q: "Si los datos son: 1, 2, 3, 4, 5. ¬øNecesitan ordenarse para la Media?", options: ["S√≠", "No", "Solo si son impares", "Solo si son pares"], correct: 1 },
                            { q: "Si los datos son: 1, 2, 3, 4, 5. ¬øNecesitan ordenarse para la Mediana?", options: ["No", "S√≠", "Solo si son impares", "Solo si son pares"], correct: 1 },
                            { q: "El valor central se calcula despu√©s de...", options: ["Sumar", "Dividir", "Ordenar", "Multiplicar"], correct: 2 },
                            { q: "La Moda puede tener m√°s de un valor.", options: ["Falso", "Verdadero", "Solo si es impar", "Solo si es par"], correct: 1 },
                            { q: "La Media siempre es uno de los datos de la lista.", options: ["Verdadero", "Falso", "A veces", "Nunca"], correct: 1 },
                            { q: "¬øQu√© medida NO se ve afectada por un valor extremo (outlier)?", options: ["Media", "Mediana", "Moda", "Promedio"], correct: 1 },
                            { q: "La suma de todos los datos dividida por la cantidad de datos es la...", options: ["Mediana", "Moda", "Media", "Frecuencia"], correct: 2 },
                            { q: "Para calcular la Media, ¬øse necesita ordenar los datos?", options: ["S√≠", "No", "Solo a veces", "Depende"], correct: 1 },
                            { q: "La medida m√°s f√°cil de calcular es la...", options: ["Media", "Mediana", "Moda", "Rango"], correct: 2 },

                            // Bloque 2: C√°lculo de la Media
                            { q: "Media de 2, 4, 6:", options: ["3", "4", "5", "6"], correct: 1 },
                            { q: "Media de 1, 1, 4:", options: ["1", "2", "3", "4"], correct: 1 },
                            { q: "Media de 10, 20:", options: ["10", "15", "20", "30"], correct: 1 },
                            { q: "Media de 5, 5, 5:", options: ["4", "5", "6", "15"], correct: 1 },
                            { q: "Media de 1, 2, 3, 4:", options: ["2", "2.5", "3", "3.5"], correct: 1 },
                            { q: "Media de 1, 5, 6:", options: ["3", "4", "5", "6"], correct: 1 },
                            { q: "Media de 8, 8, 8, 8:", options: ["7", "8", "9", "32"], correct: 1 },
                            { q: "Media de 2, 3, 4, 5, 6:", options: ["3", "4", "5", "6"], correct: 1 },
                            { q: "Media de 0, 10:", options: ["0", "5", "10", "20"], correct: 1 },
                            { q: "Media de 3, 3, 6:", options: ["3", "4", "5", "6"], correct: 1 },
                            { q: "Media de 7, 7, 7, 7, 7:", options: ["6", "7", "8", "35"], correct: 1 },
                            { q: "Media de 1, 2, 6:", options: ["2", "3", "4", "5"], correct: 1 },
                            { q: "Media de 10, 30, 50:", options: ["20", "30", "40", "50"], correct: 1 },
                            { q: "Media de 1, 1, 1, 1, 1:", options: ["0", "1", "2", "3"], correct: 1 },
                            { q: "Media de 4, 5, 6:", options: ["4", "5", "6", "5.5"], correct: 1 },
                            { q: "Media de 2, 8:", options: ["4", "5", "6", "10"], correct: 1 },
                            { q: "Media de 1, 3, 5, 7:", options: ["3", "4", "5", "4.5"], correct: 1 },
                            { q: "Media de 2, 2, 2, 2:", options: ["1", "2", "3", "4"], correct: 1 },
                            { q: "Media de 2, 4, 8:", options: ["4", "4.67", "5", "14"], correct: 1 },
                            { q: "Media de 9, 9, 9:", options: ["8", "9", "10", "27"], correct: 1 },
                            { q: "Media de 1, 1, 1, 5:", options: ["1", "2", "3", "4"], correct: 1 },
                            { q: "Media de 6, 7, 8:", options: ["6.5", "7", "7.5", "21"], correct: 1 },
                            { q: "Media de 10, 10, 20:", options: ["10", "15", "20", "40"], correct: 1 },
                            { q: "Media de 5, 10, 15:", options: ["10", "15", "20", "30"], correct: 0 },
                            { q: "Media de 10, 10:", options: ["5", "10", "15", "20"], correct: 1 },
                            { q: "Media de 1, 2, 7:", options: ["3", "4", "5", "10"], correct: 1 },

                            // Bloque 3: C√°lculo de Moda y Mediana
                            { q: "Moda de 1, 2, 2, 3, 4:", options: ["1", "2", "3", "4"], correct: 1 },
                            { q: "Mediana de 1, 2, 3:", options: ["1", "2", "3", "1.5"], correct: 1 },
                            { q: "Moda de 5, 5, 6, 7, 8:", options: ["6", "5", "7", "8"], correct: 1 },
                            { q: "Mediana de 1, 3, 5, 7:", options: ["3", "4", "5", "6"], correct: 1 },
                            { q: "Moda de 10, 10, 20, 30:", options: ["20", "10", "30", "No hay"], correct: 1 },
                            { q: "Mediana de 2, 4, 6, 8, 10:", options: ["4", "6", "8", "10"], correct: 1 },
                            { q: "Moda de 4, 5, 6, 7:", options: ["4", "6", "7", "No hay"], correct: 3 },
                            { q: "Mediana de 1, 5, 10:", options: ["1", "5", "10", "6"], correct: 1 },
                            { q: "Moda de 1, 2, 3, 3, 3:", options: ["1", "2", "3", "No hay"], correct: 2 },
                            { q: "Mediana de 10, 10, 20, 30:", options: ["10", "15", "20", "25"], correct: 1 },
                            { q: "Moda de 8, 8, 9, 10, 10:", options: ["8 y 10", "8", "10", "9"], correct: 0 },
                            { q: "Mediana de 5, 10, 15, 20, 25:", options: ["10", "15", "20", "30"], correct: 1 },
                            { q: "Moda de 1, 5, 5, 5, 6:", options: ["1", "5", "6", "No hay"], correct: 1 },
                            { q: "Mediana de 2, 2, 4:", options: ["2", "3", "4", "2.5"], correct: 0 },
                            { q: "Moda de 3, 4, 4, 5, 5:", options: ["3", "4 y 5", "5", "4"], correct: 1 },
                            { q: "Mediana de 1, 2, 4, 5:", options: ["2", "3", "4", "5"], correct: 1 },
                            { q: "Moda de 7, 7, 8, 9:", options: ["8", "7", "9", "No hay"], correct: 1 },
                            { q: "Mediana de 6, 7, 8:", options: ["6", "7", "8", "6.5"], correct: 1 },
                            { q: "Moda de 1, 1, 1, 5, 5:", options: ["1 y 5", "1", "5", "3"], correct: 1 },
                            { q: "Mediana de 3, 3, 3, 4, 5:", options: ["3", "4", "5", "3.5"], correct: 0 },
                            { q: "Moda de 0, 1, 1, 2, 2, 2:", options: ["1", "2", "0", "1 y 2"], correct: 1 },
                            { q: "Mediana de 10, 12, 14:", options: ["10", "12", "14", "13"], correct: 1 },
                            { q: "Moda de 1, 2, 3, 4, 5:", options: ["3", "1", "5", "No hay"], correct: 3 },
                            { q: "Mediana de 8, 10, 12, 14:", options: ["10", "11", "12", "14"], correct: 1 },
                            { q: "Moda de 9, 9, 9, 10:", options: ["9", "10", "9 y 10", "No hay"], correct: 0 },
                            { q: "Mediana de 1, 5, 10, 20:", options: ["5", "7.5", "10", "15"], correct: 1 },
                        ]
                    }
                }
            }
        };

        // ===================================================================
        // 2. VARIABLES GLOBALES Y JUEGOS
        // ===================================================================
        let currentExercises = [];
        let currentQ = 0;
        let points = 0;
        let level = 1;
        let completedExercises = [];
        let answeredCurrentQuestion = false;
        
        const availableGames = [
            { id: 1, name: "Arcanoid T√°ctil", func: "startGame1_Arcanoid" },
            { id: 2, name: "Juego de Pares", func: "startGame2_Memory" }, 
        ];

        let animationFrameId = null; 

        // ===================================================================
        // 3. FUNCIONES DE NAVEGACI√ìN
        // ===================================================================

        function hideAllScreens() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        }

        function goToSubjectFromLogin() {
            const name = document.getElementById('studentNameLogin').value.trim();
            const age = document.getElementById('studentAgeLogin').value.trim();
            if (!name || !age) {
                alert('Introduce tu nombre y edad');
                return;
            }
            document.getElementById('evaluationChoose').innerHTML = '<option value="">--Selecciona Evaluaci√≥n--</option>';
            Object.keys(curriculum['Matem√°ticas']['1¬∫ESO']).forEach(evalName => {
                const o = document.createElement('option');
                o.value = evalName;
                o.text = evalName;
                document.getElementById('evaluationChoose').add(o);
            });
            document.getElementById('subjectChoose').value = 'Matem√°ticas'; 
            populateTopics(); 

            hideAllScreens();
            document.getElementById('subjectScreen').classList.add('active');
        }

        function goToLogin() {
            hideAllScreens();
            document.getElementById('loginScreen').classList.add('active');
        }

        function goToSubjectFromExercise() {
            hideAllScreens();
            document.getElementById('subjectScreen').classList.add('active');
        }

        function goToReview() {
            hideAllScreens();
            document.getElementById('reviewScreen').classList.add('active');
            updateReviewScreen();
        }

        document.getElementById('evaluationChoose').addEventListener('change', populateTopics);

        function populateTopics() {
            const subject = document.getElementById('subjectChoose').value;
            const evaluation = document.getElementById('evaluationChoose').value;
            const topicSelect = document.getElementById('topicChoose');
            topicSelect.innerHTML = '<option value="">--Selecciona Tema--</option>';

            if (subject && evaluation && curriculum[subject]["1¬∫ESO"][evaluation]) {
                Object.keys(curriculum[subject]["1¬∫ESO"][evaluation]).forEach(t => {
                    const o = document.createElement('option');
                    o.value = t;
                    o.text = t;
                    topicSelect.add(o);
                });
            }
        }
        
        function endGame() {
            // Limpiar Arcanoid
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
            const canvas = document.getElementById("juegoCanvas");
            const ctx = canvas.getContext("2d");
            ctx.clearRect(0, 0, canvas.width, canvas.height); 
            document.getElementById('arcanoidGameContainer').style.display = 'none';

            // Limpiar Memory
            document.getElementById('memoryGameContainer').classList.remove('active');
            document.querySelector('.game-container-memory').innerHTML = ''; // Limpiar cartas

            hideAllScreens();
            document.getElementById('exerciseScreen').classList.add('active');
            answeredCurrentQuestion = true; 
            nextQuestion(); // Avanzar al siguiente ejercicio
        }

        // ===================================================================
        // 4. FUNCIONES DE JUEGO (EJERCICIOS)
        // ===================================================================

        function startExercises() {
            const subject = document.getElementById('subjectChoose').value;
            const evaluation = document.getElementById('evaluationChoose').value;
            const topic = document.getElementById('topicChoose').value;

            if (!subject || !evaluation || !topic) {
                alert('Selecciona asignatura, evaluaci√≥n y tema');
                return;
            }

            const original = curriculum[subject]["1¬∫ESO"][evaluation][topic];
            const shuffled = [...original];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }

            const maxQuestions = 20;
            currentExercises = shuffled.slice(0, Math.min(original.length, maxQuestions));

            currentQ = 0;
            points = 0;
            level = 1;
            completedExercises = [];
            answeredCurrentQuestion = false;

            hideAllScreens();
            document.getElementById('exerciseScreen').classList.add('active');
            document.getElementById('subjectTopic').innerText = `${subject} - ${topic}`;
            document.getElementById('totalQuestions').innerText = currentExercises.length;
            updatePoints();
            updateLevel();
            updateMedals();
            loadQuestion();
        }


        function loadQuestion() {
            answeredCurrentQuestion = false;
            if (currentQ >= currentExercises.length) {
                return goToReview(); 
            }

            const q = currentExercises[currentQ];
            document.getElementById('questionNumber').innerText = currentQ + 1;
            document.getElementById('questionText').innerText = q.q;

            const btns = document.querySelectorAll('.options button');
            btns.forEach((btn, i) => {
                btn.innerText = q.options[i];
                btn.className = '';
                btn.disabled = false; 
            });
        }

        function handleOptionClick(event) {
            if (event.target.tagName !== 'BUTTON') return;
            checkAnswer(event.target);
        }

        function checkAnswer(btn) {
            if (answeredCurrentQuestion) return; 

            const q = currentExercises[currentQ];
            const idx = parseInt(btn.getAttribute('data-option-index'));
            answeredCurrentQuestion = true; 
            
            document.querySelectorAll('.options button').forEach(b => b.disabled = true);

            if (idx === q.correct) {
                btn.classList.add('correct');
                points++; 
                completedExercises.push(q.q);
            } else {
                btn.classList.add('wrong');
                document.querySelector(`.options button[data-option-index="${q.correct}"]`).classList.add('correct');
            }
            
            updatePoints(); 
            updateMedals();
            updateLevel(); 
        }

        function nextQuestion() {
            if (!answeredCurrentQuestion) {
                alert('Debes responder la pregunta actual antes de avanzar.');
                return;
            }
            currentQ++;
            loadQuestion();
        }

        // ===================================================================
        // 5. FUNCIONES DE GAMIFICACI√ìN
        // ===================================================================

        function updatePoints() {
            document.getElementById('pointsDisplay').innerText = `Puntos: ${points}`;
            const progress = Math.min((points % 10) * 10, 100); 
            document.getElementById('progress').style.width = progress + '%';
        }

        function updateLevel() {
            const newLevel = Math.floor(points / 10) + 1;
            if (newLevel > level) {
                level = newLevel;
                startRewardGame();
            }
            document.getElementById('levelDisplay').innerText = `Nivel: ${level}`;
        }

        function updateMedals() {
            const container = document.getElementById('medals');
            container.innerHTML = '';
            const milestones = [5, 10, 20]; 
            const completedCount = completedExercises.length;

            milestones.forEach(m => {
                const medal = document.createElement('div');
                medal.classList.add('medal');
                
                let icon = 'üèÖ';
                if (m === 5) icon = 'ü•â'; 
                if (m === 10) icon = 'ü•à'; 
                if (m === 20) icon = 'ü•á'; 

                medal.textContent = icon;
                if (completedCount >= m) medal.classList.add('active');
                container.appendChild(medal);
            });
        }

        function updateReviewScreen() {
            document.getElementById('finalPoints').innerText = points;
            document.getElementById('finalLevel').innerText = level;

            const reviewDiv = document.getElementById('reviewQuestions');
            reviewDiv.innerHTML = '';
            if (completedExercises.length === 0) {
                reviewDiv.innerHTML = '<p>No acertaste ninguna pregunta en esta sesi√≥n.</p>';
                return;
            }
            completedExercises.forEach((q, i) => {
                const p = document.createElement('p');
                p.textContent = `${i + 1}. ${q}`;
                reviewDiv.appendChild(p);
            });
        }
        
        // ===================================================================
        // 6. FUNCIONES DE PREMIO (JUEGOS)
        // ===================================================================

        function startRewardGame() {
            // Oculta todos los contenedores de juego al iniciar
            document.getElementById('arcanoidGameContainer').style.display = 'none';
            document.getElementById('memoryGameContainer').classList.remove('active');

            hideAllScreens();
            document.getElementById('gameScreen').classList.add('active');
            document.getElementById('rewardLevel').innerText = level;
            
            // L√≥gica para seleccionar un juego aleatorio
            const gameIndex = Math.floor(Math.random() * availableGames.length);
            const selectedGame = availableGames[gameIndex];

            if (window[selectedGame.func]) {
                window[selectedGame.func]();
            } else {
                alert(`Error: El juego '${selectedGame.name}' no est√° implementado.`);
                endGame();
            }
        }

        // ===================================================================
        // JUEGO 1: ARCANOID T√ÅCTIL (SIN CAMBIOS)
        // ===================================================================

        function startGame1_Arcanoid() {
            document.getElementById('arcanoidGameContainer').style.display = 'block';

            const canvas = document.getElementById("juegoCanvas");
            const ctx = canvas.getContext("2d");
            
            const ancho = canvas.width;
            const alto = canvas.height;

            const paletaAltura = 10;
            const paletaAncho = 75;
            let paletaX = (ancho - paletaAncho) / 2;

            let bolaRadio = 5;
            let bolaX = ancho / 2;
            let bolaY = alto - 30;
            let velocidadX = 2; 
            let velocidadY = -2; 
            let bloquesRotos = 0; 

            const ladrilloFila = 5;
            const ladrilloColumna = 8;
            const ladrilloAncho = 30;
            const ladrilloAltura = 10;
            const ladrilloPadding = 5;
            const ladrilloOffsetSuperior = 30;
            const ladrilloOffsetIzquierda = 10;
            
            let bloques = [];
            for(let c=0; c<ladrilloColumna; c++) {
                bloques[c] = [];
                for(let r=0; r<ladrilloFila; r++) {
                    bloques[c][r] = { x: 0, y: 0, status: 1 }; 
                }
            }

            function dibujarBola() {
                ctx.beginPath();
                ctx.arc(bolaX, bolaY, bolaRadio, 0, Math.PI * 2);
                ctx.fillStyle = "#FF0077"; 
                ctx.fill();
                ctx.closePath();
            }

            function dibujarPaleta() {
                ctx.beginPath();
                ctx.rect(paletaX, alto - paletaAltura, paletaAncho, paletaAltura);
                ctx.fillStyle = "#00FFC0"; 
                ctx.fill();
                ctx.closePath();
            }

            function dibujarBloques() {
                for(let c=0; c<ladrilloColumna; c++) {
                    for(let r=0; r<ladrilloFila; r++) {
                        const b = bloques[c][r];
                        if(b.status == 1) {
                            const ladrilloX = (c * (ladrilloAncho + ladrilloPadding)) + ladrilloOffsetIzquierda;
                            const ladrilloY = (r * (ladrilloAltura + ladrilloPadding)) + ladrilloOffsetSuperior;
                            
                            b.x = ladrilloX;
                            b.y = ladrilloY;
                            
                            ctx.beginPath();
                            ctx.rect(ladrilloX, ladrilloY, ladrilloAncho, ladrilloAltura);
                            ctx.fillStyle = "#FFC821"; 
                            ctx.fill();
                            ctx.closePath();
                        }
                    }
                }
            }
            
            function colisionBloques() {
                for(let c=0; c<ladrilloColumna; c++) {
                    for(let r=0; r<ladrilloFila; r++) {
                        const b = bloques[c][r];
                        if(b.status == 1) {
                            if(bolaX > b.x && bolaX < b.x + ladrilloAncho && bolaY > b.y && bolaY < b.y + ladrilloAltura) {
                                velocidadY = -velocidadY; 
                                b.status = 0; 
                                bloquesRotos++;
                                
                                if (bloquesRotos === ladrilloFila * ladrilloColumna) {
                                    alert("¬°GANASTE EL ARCANOID! ¬°A seguir estudiando!");
                                    return endGame();
                                }
                            }
                        }
                    }
                }
            }

            function moverPaleta(clientX) {
                const canvasRect = canvas.getBoundingClientRect();
                let relativeX = clientX - canvasRect.left;

                paletaX = relativeX - paletaAncho / 2;

                if (paletaX < 0) {
                    paletaX = 0;
                } else if (paletaX + paletaAncho > ancho) {
                    paletaX = ancho - paletaAncho;
                }
            }

            canvas.onmousemove = (e) => moverPaleta(e.clientX);
            canvas.ontouchmove = (e) => {
                e.preventDefault(); 
                if(e.touches.length > 0) {
                    moverPaleta(e.touches[0].clientX);
                }
            };
            
            function dibujar() {
                ctx.clearRect(0, 0, ancho, alto);

                dibujarBloques();
                dibujarBola();
                dibujarPaleta();
                colisionBloques();

                bolaX += velocidadX;
                bolaY += velocidadY;

                if(bolaX + velocidadX > ancho - bolaRadio || bolaX + velocidadX < bolaRadio) {
                    velocidadX = -velocidadX; 
                }
                if(bolaY + velocidadY < bolaRadio) {
                    velocidadY = -velocidadY; 
                }

                if(bolaY + velocidadY > alto - bolaRadio - paletaAltura) {
                    if(bolaX > paletaX && bolaX < paletaX + paletaAncho) {
                        velocidadY = -velocidadY;
                    } else if (bolaY + velocidadY > alto - bolaRadio) {
                        alert("¬°FIN DEL JUEGO! Vuelve a los ejercicios para subir otro nivel.");
                        return endGame(); 
                    }
                }

                animationFrameId = requestAnimationFrame(dibujar);
            }

            dibujar();
        }

        // ===================================================================
        // JUEGO 2: JUEGO DE PARES (Memory) - INTEGRADO AQU√ç
        // ===================================================================
        function startGame2_Memory() {
            document.getElementById('memoryGameContainer').classList.add('active');
            const gameContainer = document.querySelector('.game-container-memory');
            gameContainer.innerHTML = ''; // Limpiar cualquier juego anterior
            document.getElementById('mensaje-victoria-memory').style.display = 'none';

            const cardsArray = [
                { name: 'icono1', img: 'üê±' },
                { name: 'icono2', img: 'ü¶Ñ' },
                { name: 'icono3', img: 'üåà' },
                { name: 'icono4', img: '‚≠ê' },
                { name: 'icono5', img: 'üçé' }
            ];

            const gameCards = [...cardsArray, ...cardsArray];

            // Funci√≥n para barajar los iconos (Fisher-Yates)
            function shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }
            
            shuffle(gameCards);

            let hasFlippedCard = false;
            let lockBoard = false;
            let firstCard, secondCard;
            let matches = 0;
            const totalMatches = cardsArray.length; // 5 pares

            function resetBoard() {
                [hasFlippedCard, lockBoard] = [false, false];
                [firstCard, secondCard] = [null, null];
            }

            function flipCard() {
                if (lockBoard) return;
                if (this === firstCard) return;

                this.classList.add('flip');

                if (!hasFlippedCard) {
                    hasFlippedCard = true;
                    firstCard = this;
                    return;
                }

                secondCard = this;
                checkForMatch();
            }

            function checkForMatch() {
                let isMatch = firstCard.dataset.card === secondCard.dataset.card;

                isMatch ? disableCards() : unflipCards();
            }

            function disableCards() {
                firstCard.removeEventListener('click', flipCard);
                secondCard.removeEventListener('click', flipCard);
                
                firstCard.classList.add('match');
                secondCard.classList.add('match');

                matches++;
                
                if (matches === totalMatches) {
                    document.getElementById('mensaje-victoria-memory').style.display = 'block';
                    // Reasignar el bot√≥n de "Jugar de nuevo" para que llame a la funci√≥n de inicio de este juego
                    document.getElementById('restartMemory').onclick = startGame2_Memory;
                }

                resetBoard();
            }

            function unflipCards() {
                lockBoard = true; 
                setTimeout(() => {
                    firstCard.classList.remove('flip');
                    secondCard.classList.remove('flip');
                    resetBoard();
                }, 1000); 
            }

            // 1. CREAR LAS CARTAS EN EL HTML
            gameCards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.classList.add('memory-card');
                cardElement.dataset.card = card.name;

                // Cara frontal (el icono/emoji)
                const frontFace = document.createElement('div');
                frontFace.classList.add('front-face');
                frontFace.textContent = card.img;

                // Cara trasera (el reverso)
                const backFace = document.createElement('div');
                backFace.classList.add('back-face');
                backFace.textContent = '‚ú®'; // Peque√±o icono en el reverso

                cardElement.appendChild(frontFace);
                cardElement.appendChild(backFace);
                
                cardElement.addEventListener('click', flipCard);
                gameContainer.appendChild(cardElement);
            });
        }


        // ===================================================================
        // 7. INICIALIZACI√ìN
        // ===================================================================
        window.onload = function() {
            hideAllScreens();
            document.getElementById('loginScreen').classList.add('active');
        };
</script>

</body>
</html>

